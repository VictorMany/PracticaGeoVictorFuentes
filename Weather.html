<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather</title>

    <!-- Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous">
    </script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

</head>

<body>




    <div class="flex-shrink-0">


        <!--NAV BAR-->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <strong><a class="navbar-brand" href="#">Brish Brash Brosh</a></strong>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarScroll"
                    aria-controls="navbarScroll" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarScroll">
                    <ul class="navbar-nav me-auto my-2 my-lg-0 navbar-nav-scroll" style="--bs-scroll-height: 100px;">
                        <li class="nav-item logged">
                            <a class="nav-link active" aria-current="page" href="#" data-toggle="modal"
                                data-target="#myAccountmodal">Mi cuenta</a>
                        </li>

                        <li class="nav-item non-logged">
                            <a class="nav-link" aria-current="page" href="#" data-toggle="modal"
                                data-target="#logInModal">Ingresar</a>
                        </li>

                        <li class="nav-item non-logged">
                            <a class="nav-link" aria-current="page" href="#" data-toggle="modal"
                                data-target="#signInModal">Regístrarse</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link logged" href="#" id="salir" tabindex="-1">Salir
                            </a>
                        </li>
                    </ul>

                </div>
            </div>
        </nav>

        <!-- Modal (INGRESAR)-->
        <div class="modal fade" id="logInModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="micuentaModalLabel">Ingresa</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formLogIn">
                            <div class="row">
                                <div class="col-12 m-2">
                                    <input type="email" id="correo" class="form-control" required
                                        placeholder="Introduce tu correo">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 m-2">
                                    <input type="password" id="contraseña" required class="form-control"
                                        placeholder="Introduce tu contraseña">
                                </div>
                            </div>
                            <div class="row text-center">
                                <div class="col-12">
                                    <input type="submit" class="btn btn-primary col-12" value="Ingresar">
                                    <p class="error text-danger" style="background-color: white;"></p>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="row text-center">
                        <div class="col-12" style="padding-left: 1.9rem; padding-right: 1.9rem; margin-bottom: 0.5rem;">
                            <button class="btn btn-danger col-12" onclick="logInGoogle()">Iniciar
                                sesion
                                con Google</button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="cerrar1" class="btn btn-secondary"
                            data-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal (REGISTRARSE)-->
        <div class="modal fade" id="signInModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="micuentaModalLabel">Regístrate</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formSignIn">
                            <div class="row">
                                <div class="col-12 m-2">
                                    <input type="text" id="rnombre" class="form-control" required
                                        placeholder="Introduce tu nombre">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 m-2">
                                    <input type="email" id="rcorreo" class="form-control" required
                                        placeholder="Introduce tu correo">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 m-2">
                                    <input type="password" id="rcontraseña" required class="form-control"
                                        placeholder="Introduce tu contraseña">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 m-2">
                                    <input type="number" step="any" id="rtelefono" class="form-control" required
                                        placeholder="Introduce tu telefono">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 m-2">
                                    <input type="text" id="rdireccion" class="form-control" required
                                        placeholder="Introduce tu dirección">
                                </div>
                            </div>
                            <div class="row text-center">
                                <div class="col-12">
                                    <input type="submit" class="btn btn-primary col-12" value="Regístrarse">
                                    <p class="error text-danger" style="background-color: white;"></p>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="cerrar2" class="btn btn-secondary"
                            data-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal MiCuenta -->
        <div class="modal fade" id="myAccountmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="micuentaModalLabel">Mi Cuenta</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row m-2">
                            <div class="col-12 datosdelacuenta">
                                Aquí va la info de su cuenta
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="weatherBody" style="display: none;" class="container-fluid">
            <div class="row" style="padding-top: 0.5rem;">
                <div class="col-12 col-md-6" style="margin-bottom: 2rem;">
                    <div class="row d-flex justify-content-around">
                        <h4 id="ciudad"
                            style="padding: 0.5rem; border-radius: 0.3rem; background-color: rgba(255, 255, 255, 0.055); color: rgb(255, 255, 255); text-align: center;">
                        </h4>
                        <button style="width: 40px; height: 40px;" class="btn btn-primary"
                            onclick="addCities()"><strong>+</strong></button>
                    </div>
                    <!--Div del mapa-->
                    <div style="color: white;">
                        <div class="row w-100" style="align-content: center; justify-content: center;">
                            <div> <img id="imgIcon" src="http://openweathermap.org/img/wn/03d@2x.png" alt="">
                            </div>
                            <div style="align-self: center; vertical-align: center; margin-top: 1rem;">
                                <strong>
                                    <p id="main"></p>
                                </strong>
                            </div>
                        </div>
                    </div>
                    <div id="gif"
                        style="border-radius: 0.5rem; 
                    -webkit-background-size: cover;
                    -moz-background-size: cover;
                    -o-background-size: cover;
                    background-size: cover;
                    width: 100%;
                    padding: 1rem;
                    height: 244px;
                    box-shadow: 0 0 16px 16px rgb(22, 22, 22) inset; background-image: url('./weatherApp/nublado.gif');">
                        <div
                            style="padding: 0.5rem; background-color: rgba(0, 0, 0, 0.418); height: 98%; border-radius: 0.5rem;">
                            <p id="nubosidad" style="color: white;"></p>
                            <p id="feelslike" style="color: white;"></p>
                            <p id="humedad" style="color: white;"></p>
                            <p id="temperatura" style="color: white;"></p>
                            <p id="temperatura-max" style="color: white;"></p>
                            <p id="temperatura-min" style="color: white;"></p>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6" style="margin-bottom: 1rem;">
                    <div id="datos"></div>
                    <div class="row w-100 d-flex justify-content-center" style="margin: 0;">
                        <input type="text" class="col-8" id="inputCty" onchange="onchangeText()"
                            onkeyup="onchangeText()" name="ciudad" placeholder="Ciudad">
                        <input type="button" class="col-4"
                            style="background-color: rgb(211, 61, 35); color: white; border-color: rgb(226, 61, 32); overflow: scroll;"
                            onclick="cargarData()" value="Buscar ciudad">
                    </div>

                    <h5
                        style="padding: 0.5rem; border-radius: 0.3rem; background-color: rgba(0, 0, 0, 0.349); color: rgb(255, 255, 255); text-align: center;">
                        Ubicación</h5>
                    <!--Div main mapa-->
                    <div id="map" style="border-radius: 0.4rem;"></div>
                    <h4 style="color: rgb(231, 231, 231); margin-top: 0.5rem;">Ciudades Guardadas</h4>

                    <select class="form-select" id="ciudades" style="width: 100%;" aria-label="Default select example">
                        <option selected>Ciudades guardadas</option>
                    </select>
                </div>

            </div>
        </div>

        <div style="color: white; text-align: center; height: 80%" id="welcome">Bienvenido a tu página del clima
        </div>
    </div>
    <footer class=" footer mt-auto py-3 text-muted bg-light">
        <div class="container">
            <strong>
                <p class="float-end mb-1" style="font-size: 1rem;">
                    <a href="#">Victor Manuel Velázquez Fuentes</a>
                </p>
            </strong>
            <p class="mb-1">Este es mi proyecto final de georeferenciados</p>
            <p>
                Se trata de una pagina que consulta los datos de una api del clima, asi como otra que se encarga de
                consultar las imágenes de los tipos de clima, un logueo en base de datos con firebase la cual guarda a
                los usuarios que se registran en la página y les guarda sus ciudades favoritas por perfil
            </p>
        </div>
    </footer>


    <!--Mis estilos globales-->
    <style>
        html,
        body {
            margin: 0px;
            padding: 0px;
            background-color: rgb(1, 11, 24);
        }

        #map {
            width: 100%;
            height: 300px;
        }

        p {
            font-size: small;
        }
    </style>

    <!--Mis funcionalidad-->
    <script>
        var informacion = ""

        function iniciaMapa(ciudad) {
            if (ciudad == undefined) {
                ciudad = "leon";
                onchangeText()
            }
            fetch("https://community-open-weather-map.p.rapidapi.com/find?q=" + ciudad, {
                    "method": "GET",
                    "headers": {
                        "x-rapidapi-key": "6d5a050519msh0f9bf2eee22a02bp101698jsn7a446bb828ba",
                        "x-rapidapi-host": "community-open-weather-map.p.rapidapi.com"
                    }
                })
                .then(response => {
                    response.json()
                        .then(function (datos) {
                            console.log(datos.list[0]);
                            var coordenadas = {
                                lat: datos.list[0].coord.lat,
                                lng: datos.list[0].coord.lon
                            };

                            informacion = "<h5>" + datos.list[0].name + ", " + datos.list[0].sys.country +
                                "</h5>"

                            informacion +=
                                "<p><strong>Nubosidad: </strong>" + datos.list[0].clouds.all + "%" + "<br>" +
                                "<p><strong>Sensación térmica: </strong>" + (parseInt(datos.list[0].main
                                    .feels_like) - 273.15) +
                                "<br>" +
                                "<p><strong>Humedad: </strong>" + datos.list[0].main.pressure + "<br>" +
                                "<p><strong>Temperatura: </strong>" + (parseInt(datos.list[0].main.temp) -
                                    273.15) + "<br>" +
                                "<p><strong>Temperatura máxima: </strong>" + (parseInt(datos.list[0].main
                                    .temp_max) - 273.15) +
                                "<br>" +
                                "<p><strong>Temperatura mínima: </strong>" + (parseInt(datos.list[0].main
                                    .temp_min) - 273.15) +
                                "<br>"

                            document.getElementById("imgIcon").src = "http://openweathermap.org/img/wn/" + datos
                                .list[0].weather[0].icon + "@2x.png"
                            cambiarGif(datos.list[0].clouds.all);
                            document.getElementById("main").innerHTML = datos.list[0].weather[0].main + ", " +
                                datos.list[0].weather[0].description
                            document.getElementById("ciudad").innerHTML = datos.list[0].name + ", " + datos
                                .list[0].sys.country
                            document.getElementById("nubosidad").innerHTML =
                                "<strong>Nubosidad: </strong>" +
                                datos.list[0]
                                .clouds.all + "%"

                            document.getElementById("feelslike").innerHTML =
                                "<strong>Sensación térmica: </strong>" + ((parseInt(datos.list[
                                    0].main.feels_like) - 273.15).toFixed(2))
                            document.getElementById("humedad")
                                .innerHTML = "<strong>Presión: </strong>" + datos
                                .list[0].main.pressure
                            document.getElementById("temperatura").innerHTML =
                                "<strong>Temperatura: </strong>" + ((parseInt(datos.list[0]
                                    .main.temp) - 273.15).toFixed(2))
                            document.getElementById("temperatura-max")
                                .innerHTML =
                                "<strong>Temperatura máxima: </strong>" + ((parseInt(datos
                                    .list[0].main.temp_max) - 273.15).toFixed(2))
                            document.getElementById(
                                    "temperatura-min").innerHTML =
                                "<strong>Temperatura mínima: </strong>" + ((parseInt(datos
                                    .list[0].main.temp_min) - 273.15).toFixed(2))

                            var props = {
                                center: coordenadas,
                                zoom: 10,
                                mapTypeControlOptions: {
                                    mapTypeIds: ['roadmap', 'style_map2']
                                }
                            };

                            var styledMapTypeOcuro = new google.maps.StyledMapType(
                                [{
                                        "elementType": "geometry",
                                        "stylers": [{
                                            "color": "#1d2c4d"
                                        }]
                                    },
                                    {
                                        "elementType": "labels.text.fill",
                                        "stylers": [{
                                            "color": "#8ec3b9"
                                        }]
                                    },
                                    {
                                        "elementType": "labels.text.stroke",
                                        "stylers": [{
                                            "color": "#1a3646"
                                        }]
                                    },
                                    {
                                        "featureType": "administrative.country",
                                        "elementType": "geometry.stroke",
                                        "stylers": [{
                                            "color": "#4b6878"
                                        }]
                                    },
                                    {
                                        "featureType": "administrative.land_parcel",
                                        "elementType": "labels.text.fill",
                                        "stylers": [{
                                            "color": "#64779e"
                                        }]
                                    },
                                    {
                                        "featureType": "administrative.province",
                                        "elementType": "geometry.stroke",
                                        "stylers": [{
                                            "color": "#4b6878"
                                        }]
                                    },
                                    {
                                        "featureType": "landscape.man_made",
                                        "elementType": "geometry.stroke",
                                        "stylers": [{
                                            "color": "#334e87"
                                        }]
                                    },
                                    {
                                        "featureType": "landscape.natural",
                                        "elementType": "geometry",
                                        "stylers": [{
                                            "color": "#023e58"
                                        }]
                                    },
                                    {
                                        "featureType": "poi",
                                        "elementType": "geometry",
                                        "stylers": [{
                                            "color": "#283d6a"
                                        }]
                                    },
                                    {
                                        "featureType": "poi",
                                        "elementType": "labels.text.fill",
                                        "stylers": [{
                                            "color": "#6f9ba5"
                                        }]
                                    },
                                    {
                                        "featureType": "poi",
                                        "elementType": "labels.text.stroke",
                                        "stylers": [{
                                            "color": "#1d2c4d"
                                        }]
                                    },
                                    {
                                        "featureType": "poi.park",
                                        "elementType": "geometry.fill",
                                        "stylers": [{
                                            "color": "#023e58"
                                        }]
                                    },
                                    {
                                        "featureType": "poi.park",
                                        "elementType": "labels.text.fill",
                                        "stylers": [{
                                            "color": "#3C7680"
                                        }]
                                    },
                                    {
                                        "featureType": "poi.school",
                                        "elementType": "geometry",
                                        "stylers": [{
                                            "color": "#0B1381"
                                        }]
                                    },
                                    {
                                        "featureType": "road",
                                        "elementType": "geometry",
                                        "stylers": [{
                                            "color": "#304a7d"
                                        }]
                                    },
                                    {
                                        "featureType": "road",
                                        "elementType": "labels.text.fill",
                                        "stylers": [{
                                            "color": "#98a5be"
                                        }]
                                    },
                                    {
                                        "featureType": "road",
                                        "elementType": "labels.text.stroke",
                                        "stylers": [{
                                            "color": "#1d2c4d"
                                        }]
                                    },
                                    {
                                        "featureType": "road.highway",
                                        "elementType": "geometry",
                                        "stylers": [{
                                            "color": "#2c6675"
                                        }]
                                    },
                                    {
                                        "featureType": "road.highway",
                                        "elementType": "geometry.stroke",
                                        "stylers": [{
                                            "color": "#255763"
                                        }]
                                    },
                                    {
                                        "featureType": "road.highway",
                                        "elementType": "labels.text.fill",
                                        "stylers": [{
                                            "color": "#b0d5ce"
                                        }]
                                    },
                                    {
                                        "featureType": "road.highway",
                                        "elementType": "labels.text.stroke",
                                        "stylers": [{
                                            "color": "#023e58"
                                        }]
                                    },
                                    {
                                        "featureType": "transit",
                                        "elementType": "labels.text.fill",
                                        "stylers": [{
                                            "color": "#98a5be"
                                        }]
                                    },
                                    {
                                        "featureType": "transit",
                                        "elementType": "labels.text.stroke",
                                        "stylers": [{
                                            "color": "#1d2c4d"
                                        }]
                                    },
                                    {
                                        "featureType": "transit.line",
                                        "elementType": "geometry.fill",
                                        "stylers": [{
                                            "color": "#283d6a"
                                        }]
                                    },
                                    {
                                        "featureType": "transit.station",
                                        "elementType": "geometry",
                                        "stylers": [{
                                            "color": "#3a4762"
                                        }]
                                    },
                                    {
                                        "featureType": "water",
                                        "elementType": "geometry",
                                        "stylers": [{
                                            "color": "#0e1626"
                                        }]
                                    },
                                    {
                                        "featureType": "water",
                                        "elementType": "labels.text.fill",
                                        "stylers": [{
                                            "color": "#4e6d70"
                                        }]
                                    }
                                ], {
                                    name: 'Mapa Oscuro'
                                }
                            );
                            map = new google.maps.Map(document.getElementById('map'), props);
                            map.mapTypes.set('style_map2', styledMapTypeOcuro);
                            map.setMapTypeId('style_map2');
                            let propiedadesMarcador = {
                                position: coordenadas,
                                map,
                                title: "Ciudad"
                            }
                            const marcador = new google.maps.Marker(propiedadesMarcador);

                            const infowindow = new google.maps.InfoWindow({
                                content: informacion,
                            })
                            marcador.addListener("click", () => {
                                infowindow.open(map, marcador);
                            })

                            marcador.addListener("mouseover", () => {
                                infowindow.open(map, marcador);
                            })
                        })
                        .catch(err => {
                            console.log(err)
                        })

                }).catch(err => {
                    console.error(err);
                });
        }

        function cargarData() {
            console.log("Hola de mi boton");
            var ciudad = document.getElementById("inputCty").value;
            console.log(ciudad);
            iniciaMapa(ciudad);
        }

        function onchangeText() {
            var autocompletado = document.getElementById('inputCty');
            autocomplete = new google.maps.places.Autocomplete(autocompletado, {
                types: ['geocode']
            });
            autocomplete.setFields(['address_component', 'geometry']);
        }

        function cambiarGif(gif) {
            console.log(gif);
            let numero = parseInt(gif);
            document.getElementById("gif").style.backgroundImage = "url('./weatherApp/nublado.gif')"

            if (numero < 25) {
                console.log("Esta soleado");
                document.getElementById("gif").style.backgroundImage = "url('./weatherApp/elise.gif')"
            } else if (numero > 25 && numero <= 60) {
                console.log("Esta medionublado");
                document.getElementById("gif").style.backgroundImage = "url('./weatherApp/poco_nublado.gif')"
            } else if (numero > 60 && numero < 90) {
                console.log("Esta nublado");
                document.getElementById("gif").style.backgroundImage = "url('./weatherApp/nublado.gif')"
            } else if (numero >= 90) {
                console.log("Esta lloviendo");
                document.getElementById("gif").style.backgroundImage = "url('./weatherApp/lluvia.gif')"

            }
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
    </script>
    <!-- Google Maps -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAv-m46ebIV9fqkE2fIBGeWunmGmBm2R24&libraries=places&callback"
        async defer></script>


    <!--Librerías de firebase-->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>


    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyDSeLvJegUWk2qsmi7Y-lDdHXt8BoPELrw",
            authDomain: "auth-b0b1f.firebaseapp.com",
            projectId: "auth-b0b1f",
            storageBucket: "auth-b0b1f.appspot.com",
            messagingSenderId: "224371149901",
            appId: "1:224371149901:web:8ac37ba6f9409f4b06e004"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>

    <script src="./weatherApp/bd.js"></script>
    <script src="./weatherApp/auth2.js"></script>

</body>

</html>